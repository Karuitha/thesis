"0","###########################################"
"0","#' ggplot Flat Violin"
"0","#' @export"
"0","#' @details Copy-pasted from https://gist.githubusercontent.com/benmarwick/2a1bb0133ff568cbe28d/raw/fb53bd97121f7f9ce947837ef1a4c65a73bffb3f/geom_flat_violin.R"
"0","#' somewhat hackish solution to:"
"0","#' https://twitter.com/EamonCaddigan/status/646759751242620928"
"0","#' based mostly on copy/pasting from ggplot2 geom_violin source:"
"0","#' https://github.com/hadley/ggplot2/blob/master/R/geom-violin.r"
"0","#' @examples:"
"0","#' ggplot(diamonds, aes(cut, carat)) +"
"0","#'   geom_flat_violin() +"
"0","#'   coord_flip()"
"0","#' @import ggplot2"
"0","geom_flat_violin <- function(mapping = NULL, data = NULL, stat = ""ydensity"","
"0","                             position = ""dodge"", trim = TRUE, scale = ""area"","
"0","                             show.legend = NA, inherit.aes = TRUE, ...) {"
"0","  layer("
"0","    data = data,"
"0","    mapping = mapping,"
"0","    stat = stat,"
"0","    geom = GeomFlatViolin,"
"0","    position = position,"
"0","    show.legend = show.legend,"
"0","    inherit.aes = inherit.aes,"
"0","    params = list("
"0","      trim = trim,"
"0","      scale = scale,"
"0","      ..."
"0","    )"
"0","  )"
"0","}"
"0",""
"0","#' @rdname ggplot2-ggproto"
"0","#' @format NULL"
"0","#' @usage NULL"
"0","#' @export"
"0","GeomFlatViolin <-"
"0","  ggproto(""GeomFlatViolin"", Geom,"
"0","          setup_data = function(data, params) {"
"0","            data$width <- data$width %||%"
"0","              params$width %||% (resolution(data$x, FALSE) * 0.9)"
"0",""
"0","            # ymin, ymax, xmin, and xmax define the bounding rectangle for each group"
"0","            data %>%"
"0","              group_by(group) %>%"
"0","              mutate(ymin = min(y),"
"0","                     ymax = max(y),"
"0","                     xmin = x,"
"0","                     xmax = x + width / 2)"
"0",""
"0","          },"
"0",""
"0","          draw_group = function(data, panel_scales, coord) {"
"0","            # Find the points for the line to go all the way around"
"0","            data <- transform(data, xminv = x,"
"0","                              xmaxv = x + violinwidth * (xmax - x))"
"0",""
"0","            # Make sure it's sorted properly to draw the outline"
"0","            newdata <- rbind(plyr::arrange(transform(data, x = xminv), y),"
"0","                             plyr::arrange(transform(data, x = xmaxv), -y))"
"0",""
"0","            # Close the polygon: set first and last point the same"
"0","            # Needed for coord_polar and such"
"0","            newdata <- rbind(newdata, newdata[1,])"
"0",""
"0","            ggplot2:::ggname(""geom_flat_violin"", GeomPolygon$draw_panel(newdata, panel_scales, coord))"
"0","          },"
"0",""
"0","          draw_key = draw_key_polygon,"
"0",""
"0","          default_aes = aes(weight = 1, colour = ""grey20"", fill = ""white"", size = 0.5,"
"0","                            alpha = NA, linetype = ""solid""),"
"0",""
"0","          required_aes = c(""x"", ""y"")"
"0","  )"
"0",""
"0",""
"0","""%||%"" <- function(a, b) {"
"0","  if (!is.null(a)) a else b"
"0","}"
"0","###########################################################"
